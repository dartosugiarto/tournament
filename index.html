<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bagan Turnamen 9 Tim</title>
    <style>
        /* =========================================== */
        /* ==     CSS MODERN (APPLE-INSPIRED)     == */
        /* =========================================== */

        :root {
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --bg-page: #f5f5f7;       /* Latar belakang abu-abu khas Apple */
            --bg-card: #ffffff;       /* Kartu putih bersih */
            --text-primary: #1d1d1f;  /* Teks hitam pekat (bukan #000) */
            --text-secondary: #6e6e73; /* Teks abu-abu */
            --border-color: #d2d2d7;   /* Border halus */
            --accent-blue: #007aff;    /* Biru Apple */
            --radius-card: 12px;      /* Sudut membulat */
            --shadow-card: 0 4px 15px rgba(0, 0, 0, 0.06);
        }

        /* 1. Global & Tata Letak */
        body {
            font-family: var(--font-main);
            background-color: var(--bg-page);
            color: var(--text-primary);
            line-height: 1.4;
            -webkit-font-smoothing: antialiased; /* Font lebih halus */
            -moz-osx-font-smoothing: grayscale;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem; /* 40px */
            font-weight: 600;
            margin: 40px 0;
            letter-spacing: -0.01em;
        }

        /* Kontainer utama bagan */
        .bracket-container {
            display: flex;
            overflow-x: auto;
            padding: 20px;
            /* Hapus latar belakang dari kontainer, biarkan kartu yang menonjol */
        }

        /* 'round' adalah kolom */
        .round {
            flex: 1;
            min-width: 250px; /* Lebar minimum lebih besar */
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding: 0 20px;
        }

        .round h3 {
            font-size: 1.1rem; /* 18px */
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 24px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }

        /* 2. Pertandingan & Tim (Kartu) */

        /* 'matchup' adalah kartu untuk 2 tim */
        .matchup {
            background: var(--bg-card);
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-card);
            margin: 16px 0;
            position: relative;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            overflow: hidden; /* Pastikan border-radius diterapkan */
        }

        /* 'team' adalah slot untuk satu tim */
        .team {
            padding: 16px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 1rem; /* 16px */
            font-weight: 500;
        }
        
        /* Garis pemisah antar tim di dalam kartu */
        .team:first-child {
            border-bottom: 1px solid #f0f0f0; /* Garis sangat halus */
        }

        .team:hover:not(.placeholder):not(.bye) {
            background-color: #f0f0f8; /* Aksen hover sangat halus */
        }

        /* Status tim */
        .team.winner {
            font-weight: 700;
            color: var(--accent-blue); /* Biru aksen */
        }

        .team.placeholder {
            color: #a0a0a0;
            font-style: italic;
            cursor: not-allowed;
            font-weight: 400;
        }

        .team.bye {
            color: var(--text-secondary);
            font-style: normal;
            cursor: default;
            background-color: #fafafa;
        }

        /* 3. Garis Konektor Modern */

        /* Garis horizontal keluar */
        .matchup::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -20px; /* Sesuaikan dengan padding .round */
            width: 20px;
            height: 2px;
            background: var(--border-color);
            transform: translateY(-50%);
            z-index: -1;
        }

        /* Garis vertikal menghubungkan */
        .round:not(:first-child) .matchup::before {
            content: '';
            position: absolute;
            left: -20px; /* Sesuaikan dengan padding .round */
            width: 2px;
            height: 102%; 
            background: var(--border-color);
            z-index: -1;
        }

        /* Atur koneksi garis vertikal */
        .round:not(:first-child) .matchup:nth-child(odd)::before {
            top: 50%;
        }

        .round:not(:first-child) .matchup:nth-child(even)::before {
            bottom: 50%;
        }
        
        /* 4. Styling Babak Final & Juara */
        
        /* Hapus garis keluar dari Final */
        .round.final .matchup::after {
            display: none;
        }

        .round.winner .matchup {
            border: 2px solid var(--accent-blue);
            box-shadow: 0 5px 20px rgba(0, 122, 255, 0.2); /* Efek glow */
        }
        
        .round.winner .team {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .round.winner .matchup::before,
        .round.winner .matchup::after {
            display: none;
        }

    </style>
</head>
<body>

    <h1>Bagan Turnamen</h1>

    <div class="bracket-container">

        <div class="round">
            <h3>Babak 1</h3>
            <div class="matchup">
                <div class="team" id="r1-1-top" data-winner-target="qf-1-top">...</div>
                <div class="team" id="r1-1-bottom">...</div>
            </div>
            <div class="matchup">
                <div class="team" id="r1-2-top" data-winner-target="qf-1-bottom">...</div>
                <div class="team" id="r1-2-bottom" data-winner-target="qf-1-bottom">...</div>
            </div>
            <div class="matchup">
                <div class="team" id="r1-3-top" data-winner-target="qf-2-top">...</div>
                <div class="team" id="r1-3-bottom" data-winner-target="qf-2-top">...</div>
            </div>
            <div class="matchup">
                <div class="team" id="r1-4-top" data-winner-target="qf-2-bottom">...</div>
                <div class="team" id="r1-4-bottom" data-winner-target="qf-2-bottom">...</div>
            </div>
            <div class="matchup">
                <div class="team" id="r1-5-top" data-winner-target="qf-3-top">...</div>
                <div class="team" id="r1-5-bottom" data-winner-target="qf-3-top">...</div>
            </div>
            <div class="matchup">
                <div class="team" id="r1-6-top" data-winner-target="qf-3-bottom">...</div>
                <div class="team" id="r1-6-bottom" data-winner-target="qf-3-bottom">...</div>
            </div>
            <div class="matchup">
                <div class="team" id="r1-7-top" data-winner-target="qf-4-top">...</div>
                <div class="team" id="r1-7-bottom" data-winner-target="qf-4-top">...</div>
            </div>
            <div class="matchup">
                <div class="team" id="r1-8-top" data-winner-target="qf-4-bottom">...</div>
                <div class="team" id="r1-8-bottom" data-winner-target="qf-4-bottom">...</div>
            </div>
        </div>

        <div class="round">
            <h3>Perempat Final</h3>
            <div class="matchup">
                <div class="team placeholder" id="qf-1-top" data-winner-target="sf-1-top">...</div>
                <div class="team placeholder" id="qf-1-bottom" data-winner-target="sf-1-top">...</div>
            </div>
            <div class="matchup">
                <div class="team placeholder" id="qf-2-top" data-winner-target="sf-1-bottom">...</div>
                <div class="team placeholder" id="qf-2-bottom" data-winner-target="sf-1-bottom">...</div>
            </div>
            <div class="matchup">
                <div class="team placeholder" id="qf-3-top" data-winner-target="sf-2-top">...</div>
                <div class="team placeholder" id="qf-3-bottom" data-winner-target="sf-2-top">...</div>
            </div>
            <div class="matchup">
                <div class="team placeholder" id="qf-4-top" data-winner-target="sf-2-bottom">...</div>
                <div class="team placeholder" id="qf-4-bottom" data-winner-target="sf-2-bottom">...</div>
            </div>
        </div>

        <div class="round">
            <h3>Semifinal</h3>
            <div class="matchup">
                <div class="team placeholder" id="sf-1-top" data-winner-target="f-1-top">...</div>
                <div class="team placeholder" id="sf-1-bottom" data-winner-target="f-1-top">...</div>
            </div>
            <div class="matchup">
                <div class="team placeholder" id="sf-2-top" data-winner-target="f-1-bottom">...</div>
                <div class="team placeholder" id="sf-2-bottom" data-winner-target="f-1-bottom">...</div>
            </div>
        </div>

        <div class="round final">
            <h3>Final</h3>
            <div class="matchup">
                <div class="team placeholder" id="f-1-top" data-winner-target="w-1">...</div>
                <div class="team placeholder" id="f-1-bottom" data-winner-target="w-1">...</div>
            </div>
        </div>

        <div class="round winner">
            <h3>Juara</h3>
            <div class="matchup">
                <div class="team placeholder" id="w-1">...</div>
            </div>
        </div>
    </div>

    <script>
        // !!! PENTING: GANTI DENGAN URL WEB APP ANDA !!!
        const WEB_APP_URL = 'https://script.google.com/macros/s/xxxxxxxxx/exec';

        document.addEventListener('DOMContentLoaded', () => {
            // 1. Muat data dari Google Sheet saat halaman dibuka
            loadBracketData();
            
            // 2. Tambahkan event listener untuk klik
            document.querySelector('.bracket-container').addEventListener('click', (e) => {
                if (e.target.classList.contains('team') &&
                    !e.target.classList.contains('placeholder') &&
                    !e.target.classList.contains('bye')) {
                    
                    advanceWinner(e.target);
                }
            });
        });

        /**
         * MEMBACA DATA (GET)
         */
        async function loadBracketData() {
            try {
                const response = await fetch(WEB_APP_URL);
                if (!response.ok) throw new Error("Gagal mengambil data: " + response.statusText);
                
                const data = await response.json(); 

                // Isi setiap slot di HTML dengan data dari sheet
                document.querySelectorAll('.team').forEach(slot => {
                    const slotId = slot.id;
                    if (slotId && data[slotId]) {
                        const teamName = data[slotId];
                        slot.textContent = teamName;
                        slot.dataset.teamName = teamName; 
                        
                        if (teamName !== '...' && teamName !== 'BYE') {
                            slot.classList.remove('placeholder');
                        }
                        if (teamName === 'BYE') {
                            slot.classList.add('bye');
                            slot.classList.remove('placeholder');
                        }
                    }
                });

                // Otomatis majukan yang melawan BYE
                autoAdvanceByes();

            } catch (error) {
                console.error('Gagal memuat data bagan:', error);
                alert('Gagal memuat data. Periksa koneksi atau URL Apps Script.');
            }
        }

        /**
         * FUNGSI LOGIKA INTI
         */
        async function advanceWinner(winningTeam) {
            const matchup = winningTeam.closest('.matchup');
            // Pastikan nama asli yang disimpan, bukan "..."
            if (!winningTeam.dataset.teamName) {
                winningTeam.dataset.teamName = winningTeam.textContent;
            }
            const teamName = winningTeam.dataset.teamName;
            
            // 1. Update visual di frontend
            matchup.querySelectorAll('.team').forEach(t => t.classList.remove('winner'));
            winningTeam.classList.add('winner');

            // 2. Cari slot target
            const targetId = winningTeam.dataset.winnerTarget;
            if (targetId) {
                const targetSlot = document.getElementById(targetId);
                if (targetSlot) {
                    // Update visual slot target
                    targetSlot.textContent = teamName;
                    targetSlot.dataset.teamName = teamName;
                    targetSlot.classList.remove('placeholder');

                    // 3. KIRIM DATA KE GOOGLE SHEET (POST)
                    await saveToSheet(targetId, teamName);

                    // 4. Periksa BYE di babak baru (setelah save)
                    checkAutoAdvance(targetSlot);
                }
            }
        }

        /**
         * MENULIS DATA (POST)
         */
        async function saveToSheet(slotId, teamName) {
            try {
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Apps Script POST seringkali butuh 'no-cors'
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ slotId: slotId, teamName: teamName }),
                });
                console.log('Data disimpan:', slotId, teamName);

            } catch (error) {
                console.error('Gagal menyimpan data:', error);
                // Kita tidak bisa tahu errornya karena 'no-cors',
                // tapi kita bisa peringatkan user
            }
        }

        // --- FUNGSI HELPER ---

        function autoAdvanceByes() {
            document.querySelectorAll('.team.bye').forEach(byeSlot => {
                const matchup = byeSlot.closest('.matchup');
                const opponent = matchup.querySelector('.team:not(.bye)');
                
                if (opponent && !opponent.classList.contains('placeholder')) {
                    const targetId = opponent.dataset.winnerTarget;
                    const targetSlot = document.getElementById(targetId);
                    
                    // Cek jika target MASIH placeholder, baru majukan
                    if (targetSlot && targetSlot.classList.contains('placeholder')) {
                         setTimeout(() => advanceWinner(opponent), 50);
                    }
                }
            });
        }
        
        function checkAutoAdvance(filledSlot) {
            const nextMatchup = filledSlot.closest('.matchup');
            const opponentSlot = Array.from(nextMatchup.querySelectorAll('.team'))
                                        .find(t => t.id !== filledSlot.id);
            
            if (opponentSlot && opponentSlot.classList.contains('bye')) {
                // Cek jika target MASIH placeholder, baru majukan
                const targetId = filledSlot.dataset.winnerTarget;
                const targetSlot = document.getElementById(targetId);

                if (targetSlot && targetSlot.classList.contains('placeholder')) {
                    setTimeout(() => advanceWinner(filledSlot), 50); 
                }
            }
        }
    </script>

</body>
</html>
